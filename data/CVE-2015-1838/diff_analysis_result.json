{
    "before_functions": "def install_agent(agent_key):\n    '''\n    Function downloads Server Density installation agent, and installs sd-agent\n    with agent_key.\n\n    CLI Example:\n\n    .. code-block:: bash\n\n        salt '*' serverdensity_device.install_agent c2bbdd6689ff46282bdaa07555641498\n    '''\n    work_dir = '/tmp/'\n    account_url = get_sd_auth('account_url')\n\n    __salt__['cmd.run'](\n        cmd='curl https://www.serverdensity.com/downloads/agent-install.sh -o install.sh',\n        cwd=work_dir\n    )\n    __salt__['cmd.run'](cmd='chmod +x install.sh', cwd=work_dir)\n\n    return __salt__['cmd.run'](\n        cmd='./install.sh -a {account_url} -k {agent_key}'.format(\n            account_url=account_url, agent_key=agent_key),\n        cwd=work_dir\n    )\n",
    "after_functions": "def install_agent(agent_key):\n    '''\n    Function downloads Server Density installation agent, and installs sd-agent\n    with agent_key.\n\n    CLI Example:\n\n    .. code-block:: bash\n\n        salt '*' serverdensity_device.install_agent c2bbdd6689ff46282bdaa07555641498\n    '''\n    work_dir = os.path.join(__opts__['cachedir'], 'tmp')\n    if not os.path.isdir(work_dir):\n        os.mkdir(work_dir)\n    install_file = tempfile.NamedTemporaryFile(dir=work_dir,\n                                                   suffix='.sh',\n                                                   delete=False)\n    install_filename = install_file.name\n    install_file.close()\n    account_url = get_sd_auth('account_url')\n\n    __salt__['cmd.run'](\n        cmd='curl https://www.serverdensity.com/downloads/agent-install.sh -o {0}'.format(install_filename),\n        cwd=work_dir\n    )\n    __salt__['cmd.run'](cmd='chmod +x {0}'.format(install_filename), cwd=work_dir)\n\n    return __salt__['cmd.run'](\n        cmd='./{filename} -a {account_url} -k {agent_key}'.format(\n            filename=install_filename, account_url=account_url, agent_key=agent_key),\n        cwd=work_dir\n    )\n"
}