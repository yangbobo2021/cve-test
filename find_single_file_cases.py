import os
import json

def find_single_file_cases(base_dir):
    single_file_cases = []
    print(f"Searching for single-file cases in {base_dir}...")
    for root, dirs, files in os.walk(base_dir):
        if 'before' in dirs and 'after' in dirs:
            before_dir = os.path.join(root, 'before')
            after_dir = os.path.join(root, 'after')

            before_files = set()
            after_files = set()

            for subroot, subdirs, subfiles in os.walk(before_dir):
                for file in subfiles:
                    before_files.add(os.path.relpath(os.path.join(subroot, file), before_dir))

            for subroot, subdirs, subfiles in os.walk(after_dir):
                for file in subfiles:
                    after_files.add(os.path.relpath(os.path.join(subroot, file), after_dir))

            if len(before_files) == 1 and len(after_files) == 1 and before_files == after_files:
                single_file_cases.append(root)

    print(f"Found {len(single_file_cases)} single-file cases.")
    return single_file_cases

def save_results_to_json(results, output_file):
    with open(output_file, 'w') as file:
        json.dump(results, file, indent=4)
    print(f"Results saved to {output_file}")

def main(base_dir, output_file):
    single_file_cases = find_single_file_cases(base_dir)
    save_results_to_json(single_file_cases, output_file)

if __name__ == "__main__":
    base_dir = 'data'
    output_file = 'single_file_cases.json'
    main(base_dir, output_file)
